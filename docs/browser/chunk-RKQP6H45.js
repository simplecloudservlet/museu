import{a as w,d as z,i as S,j as g,k as M,m as k,n as x,q as O,r as E,t as j}from"./chunk-PLB35GLF.js";var T,C=z(()=>{"use strict";j();O();T=class{constructor({marshaller:t,serializer:a,deserializer:i,serdeContext:u,defaultContentType:d}){this.marshaller=t,this.serializer=a,this.deserializer=i,this.serdeContext=u,this.defaultContentType=d}serializeEventStream(u){return S(this,arguments,function*({eventStream:t,requestSchema:a,initialRequest:i}){let d=this.marshaller,c=a.getEventStreamMember(),h=a.getMemberSchema(c),b=h.getMemberSchemas(),m=this.serializer,y=this.defaultContentType,f=Symbol("initialRequestMarker"),r={[Symbol.asyncIterator](){return M(this,null,function*(){if(i){let n={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:y}};m.write(a,i);let v=m.flush();yield{[f]:!0,headers:n,body:v}}try{for(var e=k(t),s,l,p;s=!(l=yield new g(e.next())).done;s=!1){let n=l.value;yield n}}catch{p=[l]}finally{try{s&&(l=e.return)&&(yield new g(l.call(e)))}finally{if(p)throw p[0]}}})}};return d.serialize(r,e=>{if(e[f])return{headers:e.headers,body:e.body};let s=Object.keys(e).find(I=>I!=="__type")??"",{additionalHeaders:l,body:p,eventType:n,explicitPayloadContentType:v}=this.writeEventBody(s,h,e);return{headers:w({":event-type":{type:"string",value:n},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:v??y}},l),body:p}})})}deserializeEventStream(u){return S(this,arguments,function*({response:t,responseSchema:a,initialResponseContainer:i}){let d=this.marshaller,c=a.getEventStreamMember(),b=a.getMemberSchema(c).getMemberSchemas(),m=Symbol("initialResponseMarker"),y=d.deserialize(t.body,e=>S(this,null,function*(){let s=Object.keys(e).find(l=>l!=="__type")??"";if(s==="initial-response"){let l=yield this.deserializer.read(a,e[s].body);return delete l[c],w({[m]:!0},l)}else if(s in b){let l=b[s];return{[s]:yield this.deserializer.read(l,e[s].body)}}else return{$unknown:e}})),f=y[Symbol.asyncIterator](),r=yield f.next();if(r.done)return y;if(r.value?.[m]){if(!a)throw new Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(let[e,s]of Object.entries(r.value))i[e]=s}return{[Symbol.asyncIterator](){return M(this,null,function*(){for(r?.value?.[m]||(yield r.value);;){let{done:e,value:s}=yield new g(f.next());if(e)break;yield s}})}}})}writeEventBody(t,a,i){let u=this.serializer,d=t,c=null,h,b=a.hasMemberSchema(t),m={};if(b){let r=a.getMemberSchema(t);if(r.isStructSchema()){for(let[o,e]of r.structIterator()){let{eventHeader:s,eventPayload:l}=e.getMergedTraits();if(l){c=o;break}else if(s){let p=i[t][o],n="binary";e.isNumericSchema()?(-2)**31<=p&&p<=2**31-1?n="integer":n="long":e.isTimestampSchema()?n="timestamp":e.isStringSchema()?n="string":e.isBooleanSchema()&&(n="boolean"),p!=null&&(m[o]={type:n,value:p},delete i[t][o])}}if(c!==null){let o=r.getMemberSchema(c);o.isBlobSchema()?h="application/octet-stream":o.isStringSchema()&&(h="text/plain"),u.write(o,i[t][c])}else u.write(r,i[t])}else throw new Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}else{let[r,o]=i[t];d=r,u.write(E.DOCUMENT,o)}let y=u.flush();return{body:typeof y=="string"?(this.serdeContext?.utf8Decoder??x)(y):y,eventType:d,explicitPayloadContentType:h,additionalHeaders:m}}}});var B=z(()=>{C()});B();export{T as EventStreamSerde};
